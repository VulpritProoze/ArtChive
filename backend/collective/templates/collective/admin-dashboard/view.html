{% extends "admin-dashboard/base.html" %}
{% load static %}

{% block title %}Collective Dashboard{% endblock %}

{% block content %}
<div class="mb-8">
    <h2 class="text-2xl font-bold mb-2">Collective App Statistics</h2>
    <p class="text-font-muted-light dark:text-font-muted-dark">Collective and channel statistics</p>
</div>

<!-- Time Range Selector -->
<div class="time-range-selector">
    <a href="?range=24h" class="time-range-btn {% if current_range == '24h' %}active{% endif %}">24 Hours</a>
    <a href="?range=1w" class="time-range-btn {% if current_range == '1w' %}active{% endif %}">1 Week</a>
    <a href="?range=1m" class="time-range-btn {% if current_range == '1m' %}active{% endif %}">1 Month</a>
    <a href="?range=1y" class="time-range-btn {% if current_range == '1y' %}active{% endif %}">1 Year</a>
</div>

<!-- Collective Statistics -->
<div class="mb-8">
    <h3 class="text-xl font-semibold mb-4">Collective Statistics</h3>
    <div class="dashboard-grid mb-6">
        <div class="stat-card">
            <p class="stat-card-title">Total Collectives</p>
            <p class="stat-card-value">{{ total_collectives }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Collectives (24h)</p>
            <p class="stat-card-value">{{ collectives_24h }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Collectives (1 Week)</p>
            <p class="stat-card-value">{{ collectives_1w }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Collectives (1 Month)</p>
            <p class="stat-card-value">{{ collectives_1m }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Collectives (1 Year)</p>
            <p class="stat-card-value">{{ collectives_1y }}</p>
        </div>
    </div>
    <div class="dashboard-grid-full mb-6">
        <div class="chart-container">
            <h4 class="text-lg font-medium mb-4">Collectives by Artist Type</h4>
            <div id="collective-artist-type-chart"></div>
        </div>
        <div class="chart-container">
            <h4 class="text-lg font-medium mb-4">Collective Growth Over Time</h4>
            <div id="collective-growth-chart"></div>
        </div>
    </div>
</div>

<!-- Channel Statistics -->
<div class="mb-8">
    <h3 class="text-xl font-semibold mb-4">Channel Statistics</h3>
    <div class="dashboard-grid mb-6">
        <div class="stat-card">
            <p class="stat-card-title">Total Channels</p>
            <p class="stat-card-value">{{ total_channels }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Channels (24h)</p>
            <p class="stat-card-value">{{ channels_24h }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Channels (1 Week)</p>
            <p class="stat-card-value">{{ channels_1w }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Channels (1 Month)</p>
            <p class="stat-card-value">{{ channels_1m }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-card-title">New Channels (1 Year)</p>
            <p class="stat-card-value">{{ channels_1y }}</p>
        </div>
    </div>
    <div class="dashboard-grid-full mb-6">
        <div class="chart-container">
            <h4 class="text-lg font-medium mb-4">Channels per Collective</h4>
            <div id="channels-per-collective-chart"></div>
        </div>
        <div class="chart-container">
            <h4 class="text-lg font-medium mb-4">Channel Growth Over Time</h4>
            <div id="channel-growth-chart"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Collective Growth Chart
    const collectiveGrowthData = {{ collective_growth_data|safe }};
    createDashboardChart('collective-growth-chart', {
        chart: { type: 'line' },
        series: [{
            name: 'New Collectives',
            data: collectiveGrowthData.map(item => item.y)
        }],
        xaxis: {
            categories: collectiveGrowthData.map(item => item.x),
            labels: { rotate: -45 }
        },
        yaxis: { title: { text: 'Number of Collectives' } },
        title: { text: 'Collective Growth', align: 'left' }
    });

    // Collective Artist Type Chart
    const collectiveArtistTypeData = {{ collective_artist_type_counts|safe }};
    createDashboardChart('collective-artist-type-chart', {
        chart: { type: 'pie' },
        series: collectiveArtistTypeData.map(item => item.y),
        labels: collectiveArtistTypeData.map(item => item.x),
        title: { text: 'Collectives by Artist Type', align: 'left' }
    });

    // Channel Growth Chart
    const channelGrowthData = {{ channel_growth_data|safe }};
    createDashboardChart('channel-growth-chart', {
        chart: { type: 'line' },
        series: [{
            name: 'New Channels',
            data: channelGrowthData.map(item => item.y)
        }],
        xaxis: {
            categories: channelGrowthData.map(item => item.x),
            labels: { rotate: -45 }
        },
        yaxis: { title: { text: 'Number of Channels' } },
        title: { text: 'Channel Growth', align: 'left' }
    });

    // Channels per Collective Chart
    const channelsPerCollectiveData = {{ channels_per_collective|safe }};
    createDashboardChart('channels-per-collective-chart', {
        chart: { type: 'bar' },
        series: [{
            name: 'Channels',
            data: channelsPerCollectiveData.map(item => item.y)
        }],
        xaxis: {
            categories: channelsPerCollectiveData.map(item => item.x),
            labels: { rotate: -45 }
        },
        yaxis: { title: { text: 'Number of Channels' } },
        title: { text: 'Channels per Collective', align: 'left' }
    });
</script>
{% endblock %}

